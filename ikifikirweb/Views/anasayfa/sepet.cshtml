@model ikifikir.CORE.EmailConfig.AppoinmentContact
@using ikifikir.CORE.EmailConfig

@{
    ViewData["Title"] = "fiyatOnayla";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<ComponentResult> resultList = ViewBag.ResultList as List<ComponentResult>;

    int total = Convert.ToInt32(ViewBag.Total);
}

<link href="~/assets/css/calculate.css" rel="stylesheet" />

<style>
    .tt-heading.padding-on {
        padding: 2% 0% 3% 0%;
    }

    .price-box .price-box-price .price {
        position: relative;
        display: inline-block;
        font-size: 45px;
        font-weight: bold;
    }

    .price-box .pr-box {
        padding: 0px 0px 5px 0px;
    }

    .price-box {
        position: relative;
        background-color: #fff;
        padding: 5px 0;
        text-align: center;
        z-index: 2;
        overflow: hidden;
        -webkit-box-shadow: 0 0 30px 1px rgb(0 0 0 / 14%);
        -moz-box-shadow: 0 0 30px 1px rgba(0, 0, 0, 0.14);
        box-shadow: 0 0 30px 1px rgb(0 0 0 / 14%);
        -webkit-transition: all 0.2s ease-in-out;
        -moz-transition: all 0.2s ease-in-out;
        -o-transition: all 0.2s ease-in-out;
        -ms-transition: all 0.2s ease-in-out;
        transition: all 0.2s ease-in-out;
        transform-style: preserve-3d;
    }

    .baseprice {
        perspective: 1000px;
        -webkit-perspective: 1000px;
    }
</style>

<section id="prices-section">
    <div class="prices-section-inner tt-wrap">
        <div class="price-boxes-container">
            <div class="row">
                <div class="col-sm-12">
                    <div class="tt-heading tt-heading-xlg text-center padding-on">
                        <div class="tt-heading-inner">
                            <h1 class="tt-heading-title">Fiyat Onaylandı</h1>
                            <div class="tt-heading-subtitle">Sizinle iletişime geçebilmemiz için sepeti onaylayın ve formu doldurun</div>
                        </div> <!-- /.tt-heading-inner -->
                    </div>
                </div>
            </div>
            <div class="row section-width">
                <div class="col-sm-12 baseprice">
                    <div class="price-box" id="services_price">
                            <div class="pr-box price-features" style="padding:20px;">
                                <table class="table table-condensed table-hover table-bordered" id="table_price" style="vertical-align:central; margin-bottom:0px;">
                                    <thead>
                                        <tr>
                                            <th>Hizmet</th>
                                            <th>Fiyat</th>
                                            <th>İşlem</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        @foreach (var item in resultList)
                                        {
                                            <tr id="tableRow_@item.Id">
                                                <td style="text-align:left; font-size:16px;">@item.Title</td>
                                                <td><strong style="font-size:20px; text-align:left;">@Convert.ToInt32(item.Price) ₺</strong> <input type="hidden" value="@Convert.ToInt32(item.Price)" id="price_@item.Id" /></td>
                                                <td><a onclick="removeFromTable(@item.Id);" style="cursor:pointer; position:relative; top:2px;"><span class="fa fa-window-close" style="font-size:25px;"></span></a></td>
                                            </tr>
                                        }
                                    </tbody>

                                </table>
                            </div>
                            <div class="pr-box price-box-price" style="margin-top: 10px;">
                                <div class="price" style="float: left; font-size: 30px; position: relative; left: 22px; bottom: 12px; "><span style="color:#141414; font-size:25px;">Toplam:</span> <span id="count-price">@total</span> ₺</div>
                                <a onclick="sepetiOnayla();" style="margin: 0; float: right; position: relative; right: 19px; top: -9px;" class="btn btn-primary">Sepeti Onayla</a>
                            </div>   
                    </div>
                    <div class="price-box" id="member_form">
                        <form method="post" id="form_price" action="@Url.Action("fiyatformgonder","anasayfa")">
                            <div class="contact-form-inner padding-5-p">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="NameSurname" asp-for="NameSurname" placeholder="Adınız Soyadınız..." required>
                                        </div>
                                    </div> <!-- /.col -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="PhoneNumber" asp-for="PhoneNumber" placeholder="Telefon Numarası...">
                                        </div>
                                    </div> <!-- /.col -->
                                </div> <!-- /.row -->
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="EmailAdress" asp-for="EmailAdress" placeholder="Email Adresi" required>
                                        </div>
                                    </div> <!-- /.col -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="CompanyName" asp-for="CompanyName" placeholder="Firma Adı">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <textarea class="form-control" name="Message" rows="4" asp-for="Message" placeholder="Mesajınız"></textarea>
                                        </div>
                                    </div> <!-- /.col -->
                                </div> <!-- /.row -->
                                <a onclick="teklifedon();" class="btn btn-primary margin-top-20">Teklife Dön</a>
                                @*<button type="submit" onclick="formonayla();" class="btn btn-primary margin-top-20">Gönder</button>*@
                                <button type="submit" class="btn btn-primary margin-top-20">Gönder</button>
                            </div>
                        </form>
                    </div>
                    <div class="price-box" id="done_form">
                        <div class="pr-box price-box-price">
                            <img src="https://uploads.ikifikir.net/videos/done.gif" style="width:100px;">
                        </div>
                        <div class="pr-box price-features" style="margin-top:5px;">
                            <h3 class="price-title" style="margin-bottom:5px;">Teklif formunuz başarıyla gönderildi!</h3>
                            <p style="margin:0px 0px 7px 0px;">Sizinle en kısa sürede iletişime geçeceğiz</p>
                        </div>
                        <div class="pr-box price-features">
                            <a href="@Url.Action("fiyatpaketleri","anasayfa")" class="btn btn-primary">Paketlere Dön</a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

<script src="~/assets/vendor/jquery/jquery.min.js"></script>

<script>

    var currentTotal = @total;

    var sepetiOnayla = function () {
        var memberForm = document.getElementById("member_form");
        var services = document.getElementById("services_price");

        services.style.transform = "rotateY(180deg)";
        memberForm.style.transform = "rotateY(0deg)";

    }

    var teklifedon = function () {

        var memberForm = document.getElementById("member_form");
        var services = document.getElementById("services_price");

        services.style.transform = "rotateY(0deg)";
        memberForm.style.transform = "rotateY(180deg)";
    }

    $("#form_price").submit(function (event) {
        event.preventDefault();
        var form = $(this);
        var actionUrl = form.attr('action');

        $.ajax({

            type: "POST",
            url: actionUrl,
            dataType: 'json',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: form.serialize(),
            success: function (data) {

                var memberForm = document.getElementById("member_form");
                var doneform = document.getElementById("done_form");
                memberForm.style.transform = "rotateY(180deg)";
                doneform.style.transform = "rotateY(0deg)";
            },
            error: function (data) {
                alert("Hata");
            }

        });

    })

    var removeFromTable = function (id) {

        var count = document.getElementById("count-price");
        var price = document.getElementById("price_" + id).value;

        console.log("Eski Fiyat: " + currentTotal);

        var getRow = document.getElementById("tableRow_" + id);
        getRow.remove();

        count.innerHTML = decrementTotal(price);
        console.log("Yazan Fiyat: " + count.innerHTML);

        $.ajax({
            type: "POST",
            url: "/anasayfa/sepetcikar/",
            data: { IdRemove: id },
            success: function (data) {
            }
        });

        function decrementTotal(price) {
            currentTotal = currentTotal - price;
            console.log("Yeni Fiyat: " + currentTotal);
            return currentTotal;
        }
    }

</script>